<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Pago con Payphone</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Pago con Payphone</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="container">
    <!-- Formulario de pago -->
    <ion-card *ngIf="!mostrarVerificacion">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="card-outline"></ion-icon>
          Datos del Pago
        </ion-card-title>
        <ion-card-subtitle>Completa los datos para procesar tu pago</ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <form>
          <!-- ID de Reserva -->
          <ion-item>
            <ion-label position="stacked">ID de Reserva *</ion-label>
            <ion-input 
              type="number" 
              [(ngModel)]="pagoData.reserva_id"
              name="reserva_id"
              placeholder="Ej: 123"
              required>
            </ion-input>
          </ion-item>

          <!-- Monto -->
          <ion-item>
            <ion-label position="stacked">Monto (USD) *</ion-label>
            <ion-input 
              type="number" 
              step="0.01"
              [(ngModel)]="pagoData.monto"
              name="monto"
              placeholder="Ej: 25.50"
              required>
            </ion-input>
          </ion-item>

          <!-- Teléfono -->
          <ion-item>
            <ion-label position="stacked">Número de Teléfono *</ion-label>
            <ion-input 
              type="tel" 
              [(ngModel)]="pagoData.telefono"
              name="telefono"
              placeholder="Ej: 0987654321"
              (ionInput)="onTelefonoChange()"
              required>
            </ion-input>
            <ion-note slot="helper">Formato: 0987654321 o +593987654321</ion-note>
          </ion-item>

          <!-- Descripción -->
          <ion-item>
            <ion-label position="stacked">Descripción (Opcional)</ion-label>
            <ion-textarea 
              [(ngModel)]="pagoData.descripcion"
              name="descripcion"
              placeholder="Descripción del pago"
              rows="2">
            </ion-textarea>
          </ion-item>

          <!-- Botón de pago -->
          <ion-button 
            expand="full" 
            shape="round" 
            class="ion-margin-top"
            (click)="procesarPago()">
            <ion-icon name="phone-portrait-outline" slot="start"></ion-icon>
            Pagar con Payphone
          </ion-button>
        </form>
      </ion-card-content>
    </ion-card>

    <!-- Panel de verificación -->
    <ion-card *ngIf="mostrarVerificacion">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="checkmark-circle-outline"></ion-icon>
          Verificación de Pago
        </ion-card-title>
        <ion-card-subtitle>ID: {{ transactionId }}</ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <!-- Estado actual -->
        <div class="estado-pago" *ngIf="estadoPago">
          <ion-chip [color]="payphoneService.esPagoExitoso(estadoPago) ? 'success' : 'primary'">
            <ion-icon [name]="payphoneService.esPagoExitoso(estadoPago) ? 'checkmark' : 'time'"></ion-icon>
            <ion-label>{{ payphoneService.getMensajeEstado(estadoPago) }}</ion-label>
          </ion-chip>
        </div>

        <!-- Instrucciones -->
        <ion-item lines="none" class="instrucciones">
          <ion-icon name="information-circle" slot="start" color="primary"></ion-icon>
          <ion-label class="ion-text-wrap">
            <h3>Instrucciones:</h3>
            <p>1. Revisa tu teléfono móvil</p>
            <p>2. Abre la notificación de Payphone</p>
            <p>3. Confirma el pago siguiendo las instrucciones</p>
            <p>4. Regresa aquí para verificar el estado</p>
          </ion-label>
        </ion-item>

        <!-- Botones de acción -->
        <div class="botones-accion">
          <ion-button 
            fill="outline" 
            expand="block"
            (click)="verificarEstado()">
            <ion-icon name="refresh" slot="start"></ion-icon>
            Verificar Estado
          </ion-button>

          <ion-button 
            fill="solid" 
            expand="block" 
            color="success"
            (click)="confirmarPago()"
            *ngIf="!payphoneService.esPagoExitoso(estadoPago)">
            <ion-icon name="checkmark" slot="start"></ion-icon>
            Confirmar Pago
          </ion-button>

          <ion-button 
            fill="solid" 
            expand="block" 
            color="danger"
            (click)="cancelarPago()"
            *ngIf="!payphoneService.esPagoExitoso(estadoPago)">
            <ion-icon name="close" slot="start"></ion-icon>
            Cancelar Pago
          </ion-button>

          <ion-button 
            fill="clear" 
            expand="block"
            (click)="resetearFormulario()">
            <ion-icon name="arrow-back" slot="start"></ion-icon>
            Nuevo Pago
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Información adicional -->
    <ion-card class="info-card">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="help-circle-outline"></ion-icon>
          ¿Qué es Payphone?
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p>Payphone es un sistema de pagos móviles que te permite pagar de forma rápida y segura usando tu teléfono celular.</p>
        <ion-list>
          <ion-item lines="none">
            <ion-icon name="shield-checkmark" slot="start" color="success"></ion-icon>
            <ion-label>Pagos seguros y encriptados</ion-label>
          </ion-item>
          <ion-item lines="none">
            <ion-icon name="flash" slot="start" color="warning"></ion-icon>
            <ion-label>Transacciones instantáneas</ion-label>
          </ion-item>
          <ion-item lines="none">
            <ion-icon name="phone-portrait" slot="start" color="primary"></ion-icon>
            <ion-label>Solo necesitas tu teléfono</ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
